<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="style.css">
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <title>Todo list</title>
</head>
<body>
  <div class="container-sm">
    <h1>Todo</h1>
    <form action="#">
      <div class="row">
        <div class="col-9">
          <div class="form-floating">
          <input type="text" class="form-control add-input" id="floatingPassword" placeholder="What needs to be done?">
          <label for="floatingPassword">What needs to be done?</label>
          </div>
        </div>
        <div class="col-3 d-grid gap-2"><button class="btn btn-outline-primary add" type="button">ADD</button></div>
      </form>
    </div>
      <ul class="list-group">
        <li class="list-group-item">
          <input class="form-check-input me-1" type="checkbox" value="" aria-label="...">
          <span class="list-group-text">First checkbox</span>
          <i class="fa fa-pencil-square-o fa-lg edit" aria-hidden="true"></i>
          <i class="fa fa-trash-o fa-lg delete" aria-hidden="true"></i>
        </li>
        <li class="list-group-item">
          <input class="form-check-input me-1" type="checkbox" value="" aria-label="...">
          <span class="list-group-text">Second checkbox</span>
          <i class="fa fa-pencil-square-o fa-lg edit" aria-hidden="true"></i>
          <i class="fa fa-trash-o fa-lg delete" aria-hidden="true"></i>
        </li>
      </ul>
      <div class="bottom-option">
        <button class="btn btn-outline-primary btn-sm" type="button">儲存</button>
        <span class="btn-group btn-group-sm options" role="group" aria-label="Basic radio toggle button group">
          <input type="radio" class="btn-check" name="btnradio" id="btnradio1" autocomplete="off" checked>
          <label class="btn btn-outline-secondary" for="btnradio1">All</label>
          <input type="radio" class="btn-check" name="btnradio" id="btnradio2" autocomplete="off">
          <label class="btn btn-outline-secondary" for="btnradio2">Active</label>
          <input type="radio" class="btn-check" name="btnradio" id="btnradio3" autocomplete="off">
          <label class="btn btn-outline-secondary" for="btnradio3">Completed</label>
        </span>
        <button type="button" class="btn btn-sm btn-outline-danger" id="clear">clear completed</button>
      </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  <script type="text/javascript">
    $('.list-group').click( e => {  //完成待辦事件
      let target = $(e.target)
      if (target.is("input[type='checkbox']")) {
        target.parent().find('.list-group-text').toggleClass('line-through')
      }
    })

    $('.add').click( e => { //新增留言
      const input = $('.add-input').val()
      addTodo(input)
      $('.add-input').val('')
    })

    $('.list-group').click( e => {  //編輯和刪除功能
      let target = $(e.target)
      let element = target.siblings('.list-group-text')
      if (target.is(".delete")) {
        target.parent().remove()
      } else if (target.is(".edit")) {  
        target.parent().prop("outerHTML",`<li class="list-group-item">
          <input type="text" class="form-control edited-input" value="${element.text()}"></li>`)
      }
    })
    // 點擊離開編輯模式
    $('html').click(e => {
      let target = $(e.target)
      if ($('*').not('.edited-input').is(target) && $('.edited-input').length) {
        let text = $('.edited-input').val()
        $('.edited-input').prop("outerHTML", `<input class="form-check-input me-1" type="checkbox" value="" aria-label="...">
          <span class="list-group-text">${escapeHtml(text)}</span>
          <i class="fa fa-pencil-square-o fa-lg edit" aria-hidden="true"></i>
          <i class="fa fa-trash-o fa-lg delete" aria-hidden="true"></i>`)
      }
    })

    $('.list-group').on('keydown', e => {  //按下 enter 離開編輯狀態
      if ((e.which === 13) && $('.edited-input') && $('.edited-input').val() !== '') {
        let text = e.target.value
        let target = $('.edited-input')
        target.prop("outerHTML", `<input class="form-check-input me-1" type="checkbox" value="" aria-label="...">
          <span class="list-group-text">${escapeHtml(text)}</span>
          <i class="fa fa-pencil-square-o fa-lg edit" aria-hidden="true"></i>
          <i class="fa fa-trash-o fa-lg delete" aria-hidden="true"></i>`)
        e.target.remove()
      }
    })
    // 篩選功能
    $('.bottom-option').change( e => {
      const all = $("#btnradio1")
      const active = $("#btnradio2")
      const completed = $("#btnradio3")

      if ($(e.target).is(all)) {
        $('.list-group input').parent().slideDown()
      } else if ($(e.target).is(active)) {
        $('.list-group input').parent().slideDown()
        $('.list-group input:checked').parent().slideUp()
      } else if ($(e.target).is(completed)) {
        $('.list-group input').parent().slideDown()
        $('.list-group input:not(:checked)').parent().slideUp()
      }
    })
    // clear 按鍵功能
    $('.bottom-option').click( e => {
      const clear = $("#clear")
      if ($(e.target).is(clear)) {
        $('.list-group input:checked').parent().slideUp("normal", function () {
           $(this).remove()
        })
      }
    })

    function addTodo(input) {
      $('.list-group').append(`
        <li class="list-group-item">
          <input class="form-check-input me-1" type="checkbox" value="" aria-label="...">
          <span class="list-group-text">${escapeHtml(input)}</span>
          <i class="fa fa-pencil-square-o fa-lg edit" aria-hidden="true"></i>
          <i class="fa fa-trash-o fa-lg delete" aria-hidden="true"></i>
        </li>
      `)
    }
    function escapeHtml(unsafe) {
    return unsafe
         .replace(/&/g, "&amp;")
         .replace(/</g, "&lt;")
         .replace(/>/g, "&gt;")
         .replace(/"/g, "&quot;")
         .replace(/'/g, "&#039;");
    }
  </script>
</body>
</html>